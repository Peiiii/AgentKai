# AgentKai Monorepo 迁移计划

## 背景与目标

当前，AgentKai的所有代码都位于单一仓库中，这导致难以分离核心功能与命令行界面(CLI)，限制了代码在浏览器环境中的复用。通过迁移到monorepo架构，我们可以：

1. 将核心功能与CLI界面分离，提高代码复用性
2. 为浏览器环境提供可用的核心包
3. 简化依赖管理与版本控制
4. 提高项目的可维护性和可扩展性

## 整体架构

迁移后的项目结构将基于pnpm workspaces，包含以下主要包：

- `@agentkai/core` - 核心功能，包含AI系统、记忆系统、目标管理等
- `@agentkai/cli` - 命令行界面
- `@agentkai/web` - Web界面（未来扩展）

## 迁移步骤

### 1. 初始化monorepo结构

- 创建pnpm workspace配置
- 设置基本目录结构
- 配置共享的TypeScript、ESLint和其他工具配置

### 2. 拆分核心包

- 识别和提取核心功能到`@agentkai/core`
- 确定合适的API边界
- 迁移相关测试

### 3. 创建CLI包

- 将CLI相关代码移至`@agentkai/cli`
- 调整导入路径，使用核心包
- 确保CLI功能正常工作

### 4. 更新构建与发布流程

- 配置每个包的构建脚本
- 设置版本控制与发布策略
- 更新CI/CD流程

### 5. 测试与验证

- 验证所有包的功能
- 确保向后兼容性
- 测试安装和使用流程

## 迁移进度追踪

| 任务 | 状态 | 完成日期 | 备注 |
|------|------|---------|------|
| 初始化monorepo结构 | 未开始 | - | - |
| 拆分核心包 | 未开始 | - | - |
| 创建CLI包 | 未开始 | - | - |
| 更新构建与发布流程 | 未开始 | - | - |
| 测试与验证 | 未开始 | - | - |

## 技术选择

- 包管理器：**pnpm** (高效、快速、节省磁盘空间)
- Monorepo工具：**pnpm workspaces** (简单易用，与pnpm完美集成)
- 构建工具：**TypeScript** (保持现有技术栈)
- 发布工具：**Changesets** (精细控制版本发布)

## 潜在风险与缓解策略

1. **向后兼容性问题**
   - 缓解：维护API稳定性，为重大变更提供明确的迁移路径

2. **依赖关系复杂化**
   - 缓解：使用pnpm的高效依赖管理，避免冗余安装

3. **构建流程变复杂**
   - 缓解：提供清晰的文档和脚本，自动化常见操作

4. **版本控制挑战**
   - 缓解：使用Changesets管理版本和变更日志 